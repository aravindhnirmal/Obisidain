[[Keep/Colour/DEFAULT]] [[Keep/Archived]] 

%{
[[include]] <stdio.h>
[[include]] <stdlib.h>
[[include]] "three_address_code.h"
%}

%token NUMBER

%%

program:   /* empty */
         | program statement '\n'
         ;

statement: expression      { printf("%s\n", $1); }
         | error '\n'      { yyerrok; }
         ;

expression: NUMBER          { $$ = new_temp(); emit("%d = %d", $$, $1); }
          | expression '+' expression  { $$ = new_temp(); emit("%d = %d + %d", $$, $1, $3); }
          | expression '-' expression  { $$ = new_temp(); emit("%d = %d - %d", $$, $1, $3); }
          | expression '*' expression  { $$ = new_temp(); emit("%d = %d * %d", $$, $1, $3); }
          | expression '/' expression  { $$ = new_temp(); emit("%d = %d / %d", $$, $1, $3); }
          | '(' expression ')'        { $$ = $2; }
          | '-' expression %prec UMINUS { $$ = new_temp(); emit("%d = -%d", $$, $2); }
          ;

%%

int main() {
    yyparse();
    return 0;
}

int yyerror(const char* msg) {
    fprintf(stderr, "Error: %s\n", msg);
    return 0;
}
